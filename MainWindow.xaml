<Window x:Class="TTS1.WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="TTS Multi-Provider with Split Support" 
        Height="700" Width="1050"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- Styles -->
        <Style x:Key="GroupBoxStyle" TargetType="GroupBox">
            <Setter Property="Margin" Value="10,5"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <Style x:Key="LabelStyle" TargetType="Label">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="5,0"/>
        </Style>

        <Style x:Key="SplitButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Provider Selection Panel -->
        <GroupBox Grid.Row="0" Header="TTS Provider Configuration" Style="{StaticResource GroupBoxStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="250"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Provider Selection -->
                <Label Grid.Row="0" Grid.Column="0" Content="TTS Provider:" Style="{StaticResource LabelStyle}"/>
                <ComboBox Grid.Row="0" Grid.Column="1" 
                          Name="cboProvider" 
                          Margin="5"
                          SelectedIndex="{Binding SelectedProviderIndex, Mode=TwoWay}">
                    <ComboBoxItem>Windows SAPI</ComboBoxItem>
                    <ComboBoxItem>Google Cloud TTS</ComboBoxItem>
                </ComboBox>

                <Label Grid.Row="0" Grid.Column="2" Content="Google API Key:" Style="{StaticResource LabelStyle}"/>
                <PasswordBox Grid.Row="0" Grid.Column="3" 
                            Name="txtApiKey" 
                            Margin="5"
                            IsEnabled="{Binding IsGoogleProviderSelected}"
                            PasswordChanged="txtApiKey_PasswordChanged"/>

                <!-- Voice Selection -->
                <Label Grid.Row="1" Grid.Column="0" Content="Voice:" Style="{StaticResource LabelStyle}"/>
                <ComboBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2"
                          Name="cboVoice" 
                          Margin="5"
                          ItemsSource="{Binding AvailableVoices}"
                          SelectedItem="{Binding SelectedVoice, Mode=TwoWay}"/>
                
                <Button Grid.Row="1" Grid.Column="3" 
                        Name="btnTestVoice"
                        Content="Test Voice" 
                        Margin="5"
                        Click="btnTestVoice_Click"/>
            </Grid>
        </GroupBox>

        <!-- Prosody and Emphasis Controls -->
        <GroupBox Grid.Row="1" Header="Prosody and Emphasis" Style="{StaticResource GroupBoxStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="50"/>
                    <ColumnDefinition Width="100"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="50"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Rate Control -->
                <Label Grid.Row="0" Grid.Column="0" Content="Rate (%):" Style="{StaticResource LabelStyle}"/>
                <Slider Grid.Row="0" Grid.Column="1" 
                        Name="trkRate"
                        Minimum="-50" Maximum="50" 
                        Value="{Binding RatePercent, Mode=TwoWay}"
                        TickFrequency="10" 
                        IsSnapToTickEnabled="True"
                        Margin="5"/>
                <TextBlock Grid.Row="0" Grid.Column="2" 
                          Text="{Binding ElementName=trkRate, Path=Value, StringFormat={}{0:0}}"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Center"/>

                <!-- Pitch Control -->
                <Label Grid.Row="0" Grid.Column="3" Content="Pitch (st):" Style="{StaticResource LabelStyle}"/>
                <Slider Grid.Row="0" Grid.Column="4" 
                        Name="trkPitch"
                        Minimum="-12" Maximum="12" 
                        Value="{Binding PitchSemitones, Mode=TwoWay}"
                        TickFrequency="2" 
                        IsSnapToTickEnabled="True"
                        Margin="5"/>
                <TextBlock Grid.Row="0" Grid.Column="5" 
                          Text="{Binding ElementName=trkPitch, Path=Value, StringFormat={}{0:0}}"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Center"/>

                <!-- Break Control -->
                <Label Grid.Row="1" Grid.Column="0" Content="Break (ms):" Style="{StaticResource LabelStyle}"/>
                <Slider Grid.Row="1" Grid.Column="1" 
                        Name="trkBreak"
                        Minimum="0" Maximum="2000" 
                        Value="{Binding BreakMs, Mode=TwoWay}"
                        TickFrequency="200" 
                        IsSnapToTickEnabled="True"
                        Margin="5"/>
                <TextBlock Grid.Row="1" Grid.Column="2" 
                          Text="{Binding ElementName=trkBreak, Path=Value, StringFormat={}{0:0}}"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Center"/>

                <!-- Volume Control -->
                <Label Grid.Row="2" Grid.Column="0" Content="Volume:" Style="{StaticResource LabelStyle}"/>
                <ComboBox Grid.Row="2" Grid.Column="1" 
                          Name="cboVolume"
                          Margin="5"
                          SelectedValue="{Binding VolumeLevel, Mode=TwoWay}"
                          SelectedValuePath="Content">
                    <ComboBoxItem Content="silent"/>
                    <ComboBoxItem Content="x-soft"/>
                    <ComboBoxItem Content="soft"/>
                    <ComboBoxItem Content="medium" IsSelected="True"/>
                    <ComboBoxItem Content="loud"/>
                    <ComboBoxItem Content="x-loud"/>
                </ComboBox>

                <!-- Emphasis Control -->
                <Label Grid.Row="2" Grid.Column="3" Content="Emphasis:" Style="{StaticResource LabelStyle}"/>
                <ComboBox Grid.Row="2" Grid.Column="4" 
                          Name="cboEmphasis"
                          Margin="5"
                          SelectedValue="{Binding EmphasisLevel, Mode=TwoWay}"
                          SelectedValuePath="Content">
                    <ComboBoxItem Content="none" IsSelected="True"/>
                    <ComboBoxItem Content="reduced"/>
                    <ComboBoxItem Content="moderate"/>
                    <ComboBoxItem Content="strong"/>
                </ComboBox>

                <!-- Use SSML Checkbox -->
                <CheckBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                          Content="Use SSML (recommended)"
                          IsChecked="{Binding UseSSML, Mode=TwoWay}"
                          Margin="5"
                          VerticalAlignment="Center"/>
            </Grid>
        </GroupBox>

        <!-- Input Text -->
        <GroupBox Grid.Row="2" Header="Input Text (use &lt;split&gt; or &lt;split/&gt; to separate files)" 
                  Style="{StaticResource GroupBoxStyle}">
            <TextBox Name="txtInput"
                     Text="{Binding InputText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     TextWrapping="Wrap"
                     AcceptsReturn="True"
                     VerticalScrollBarVisibility="Auto"
                     MinHeight="100"
                     Margin="5"/>
        </GroupBox>

        <!-- SSML Preview -->
        <GroupBox Grid.Row="3" Header="SSML Preview (first chunk)" Style="{StaticResource GroupBoxStyle}">
            <TextBox Name="txtSSMLPreview"
                     Text="{Binding SSMLPreview, Mode=OneWay}"
                     IsReadOnly="True"
                     TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"
                     Background="#F5F5F5"
                     FontFamily="Consolas"
                     Margin="5"/>
        </GroupBox>

        <!-- Control Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Center" Margin="10">
            <Button Name="btnSpeakAll" 
                    Content="Speak All" 
                    Width="120"
                    Margin="5"
                    Click="btnSpeakAll_Click"/>
            
            <Button Name="btnSaveWav" 
                    Content="Save as WAV" 
                    Width="120"
                    Margin="5"
                    Click="btnSaveWav_Click"/>
            
            <Button Name="btnSaveMp3" 
                    Content="Save as MP3" 
                    Width="120"
                    Margin="5"
                    Click="btnSaveMp3_Click"/>
            
            <Button Name="btnSaveSplitWav" 
                    Content="Split to WAVs" 
                    Width="120"
                    Background="LightGreen"
                    Style="{StaticResource SplitButtonStyle}"
                    Click="btnSaveSplitWav_Click"/>
            
            <Button Name="btnSaveSplitMp3" 
                    Content="Split to MP3s" 
                    Width="120"
                    Background="LightBlue"
                    Style="{StaticResource SplitButtonStyle}"
                    Click="btnSaveSplitMp3_Click"/>
        </StackPanel>

        <!-- Status Bar -->
        <StatusBar Grid.Row="5">
            <StatusBarItem>
                <TextBlock Name="statusLabel" Text="{Binding StatusText}"/>
            </StatusBarItem>
        </StatusBar>
        
        <!-- Waveform Editor Panel (Always Visible) -->
        <GroupBox Grid.Row="6" Header="Audio Waveform Editor" Style="{StaticResource GroupBoxStyle}">
            <Grid Height="300">
                <Grid.RowDefinitions>
                    <RowDefinition Height="35"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="30"/>
                </Grid.RowDefinitions>
                
                <!-- Waveform Toolbar -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                    <Button Name="btnGenerateWaveform" Content="Generate Audio Preview" Click="btnGenerateWaveform_Click" Margin="2" Padding="5,2"/>
                    <Separator Width="10"/>
                    <Label Content="Click waveform to add marker" VerticalAlignment="Center"/>
                    <Separator Width="10"/>
                    <Button Name="btnPlaySegment" Content="▶ Play Selected" Click="btnPlaySegment_Click" Margin="2" Padding="5,2"/>
                    <Button Name="btnClearMarkers" Content="Clear Markers" Click="btnClearMarkers_Click" Margin="2" Padding="5,2"/>
                    <Separator Width="10"/>
                    <Button Name="btnGenerateMultiVoice" Content="Generate Multi-Voice Audio" 
                            Click="btnGenerateMultiVoice_Click" 
                            Background="LightGreen" 
                            FontWeight="Bold"
                            Margin="2" Padding="10,2"/>
                </StackPanel>
                
                <!-- Waveform Display -->
                <Border Grid.Row="1" Name="WaveformContainer" BorderBrush="Gray" BorderThickness="1" Margin="5">
                    <!-- WaveformControl will be inserted here -->
                </Border>
                
                <!-- Segment Info Bar -->
                <Border Grid.Row="2" Background="#F0F0F0" Margin="5,0">
                    <TextBlock Name="SegmentInfoText" 
                               VerticalAlignment="Center" 
                               Margin="10,0"
                               Text="Click 'Generate Audio Preview' to visualize your text as audio"/>
                </Border>
            </Grid>
        </GroupBox>
    </Grid>
</Window>