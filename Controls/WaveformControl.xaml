<UserControl x:Class="TTS1.WPF.Controls.WaveformControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="800">
    
    <UserControl.Resources>
        <!-- Marker Style -->
        <Style x:Key="MarkerStyle" TargetType="Line">
            <Setter Property="Stroke" Value="Red"/>
            <Setter Property="StrokeThickness" Value="2"/>
            <Setter Property="Opacity" Value="0.8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="StrokeThickness" Value="3"/>
                    <Setter Property="Opacity" Value="1"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Segment Style -->
        <Style x:Key="SegmentStyle" TargetType="Rectangle">
            <Setter Property="Opacity" Value="0.3"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="30"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="25"/>
        </Grid.RowDefinitions>
        
        <!-- Timeline Ruler -->
        <Canvas Grid.Row="0" Name="TimelineRuler" Background="WhiteSmoke"/>
        
        <!-- Waveform Display Area -->
        <Grid Grid.Row="1">
            <Canvas Name="WaveformCanvas" Background="Black" ClipToBounds="True"/>
            <Canvas Name="OverlayCanvas" Background="Transparent" 
                    MouseLeftButtonDown="OverlayCanvas_MouseLeftButtonDown"
                    MouseRightButtonDown="OverlayCanvas_MouseRightButtonDown"
                    ClipToBounds="True"/>
        </Grid>
        
        <!-- Voice Labels -->
        <Canvas Grid.Row="2" Name="LabelsCanvas" Background="LightGray"/>
        
        <!-- Segment Editor Popup -->
        <Popup Name="SegmentEditorPopup" 
               StaysOpen="False" 
               Placement="Mouse"
               AllowsTransparency="True">
            <Border Background="White" 
                    BorderBrush="Gray" 
                    BorderThickness="2" 
                    CornerRadius="5"
                    Padding="10">
                <StackPanel Width="250">
                    <TextBlock Text="Segment Settings" FontWeight="Bold" Margin="0,0,0,10"/>
                    
                    <!-- Voice Selection -->
                    <Label Content="Voice:"/>
                    <ComboBox Name="PopupVoiceCombo" Margin="0,0,0,5"/>
                    
                    <!-- Rate -->
                    <Label Content="Rate:"/>
                    <Slider Name="PopupRateSlider" Minimum="-50" Maximum="50" Value="0" Margin="0,0,0,5"/>
                    
                    <!-- Pitch -->
                    <Label Content="Pitch:"/>
                    <Slider Name="PopupPitchSlider" Minimum="-12" Maximum="12" Value="0" Margin="0,0,0,5"/>
                    
                    <!-- Volume -->
                    <Label Content="Volume:"/>
                    <ComboBox Name="PopupVolumeCombo" Margin="0,0,0,5">
                        <ComboBoxItem Content="silent"/>
                        <ComboBoxItem Content="x-soft"/>
                        <ComboBoxItem Content="soft"/>
                        <ComboBoxItem Content="medium" IsSelected="True"/>
                        <ComboBoxItem Content="loud"/>
                        <ComboBoxItem Content="x-loud"/>
                    </ComboBox>
                    
                    <!-- Emphasis -->
                    <Label Content="Emphasis:"/>
                    <ComboBox Name="PopupEmphasisCombo" Margin="0,0,0,5">
                        <ComboBoxItem Content="none" IsSelected="True"/>
                        <ComboBoxItem Content="reduced"/>
                        <ComboBoxItem Content="moderate"/>
                        <ComboBoxItem Content="strong"/>
                    </ComboBox>
                    
                    <!-- Break -->
                    <Label Content="Break (ms):"/>
                    <Slider Name="PopupBreakSlider" Minimum="0" Maximum="2000" Value="0" Margin="0,0,0,10"/>
                    
                    <!-- Buttons -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button Content="â–¶ Play" Click="PlaySegment_Click" Margin="5" Padding="10,5" Background="LightGreen"/>
                        <Button Content="Apply" Click="ApplySegmentSettings_Click" Margin="5" Padding="10,5"/>
                        <Button Content="Delete Marker" Click="DeleteMarker_Click" Margin="5" Padding="10,5"/>
                        <Button Content="Cancel" Click="CancelSegmentEdit_Click" Margin="5" Padding="10,5"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Popup>
    </Grid>
</UserControl>